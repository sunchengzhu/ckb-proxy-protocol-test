global
    log stdout format raw local0 info
    maxconn 4096

defaults
    log     global
    mode    tcp
    option  tcplog
    option  dontlognull
    timeout connect 10s
    timeout client  300s
    timeout server  300s

# ============================================
# 场景1: TCP 代理 - PROXY Protocol v2
# 节点A 连 127.0.0.1:18115 -> haproxy -> 127.0.0.1:8115 (节点B)
# ============================================
frontend tcp_proxy
    bind *:18115
    default_backend tcp_backend

backend tcp_backend
    server ckb 127.0.0.1:8115 send-proxy-v2

# ============================================
# 场景2: WebSocket 代理 - X-Forwarded-For
# 节点A 连 ws://127.0.0.1:18080 -> haproxy -> 127.0.0.1:8115 (节点B)
# ============================================
frontend ws_proxy
    bind *:18080
    mode http
    default_backend ws_backend

backend ws_backend
    mode http
    option forwardfor
    http-request set-header X-Forwarded-Port %[src_port]
    server ckb 127.0.0.1:8115
